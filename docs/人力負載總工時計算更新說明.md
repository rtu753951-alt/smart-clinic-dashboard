# 人力負載總工時計算方式更新說明

## 📋 變更摘要

根據您的需求，已更新總工時的計算方式，並加入診所營業說明註解。

---

## 🔄 計算方式變更

### 舊版計算

```typescript
// 醫師：每日6小時；其他：每日8小時
const dailyHours = role === "doctor" ? 6 : 8;

// 本週/下週：5個工作天
// 未來30天：22個工作天
const totalHours = count * dailyHours * workingDays;
```

**問題**：

- 使用工作天概念（5 天/週）
- 醫師和其他職務使用不同的每日工時

---

### 新版計算

```typescript
// 所有職務統一：每日8小時
// 本週/下週：7天（診所營業7天）
// 未來30天：30天
const totalHours = count * 8 * totalDays;
```

**改進**：

- ✅ 所有職務統一使用 8 小時/天
- ✅ 本週/下週使用 7 天（診所營業 7 天）
- ✅ 未來 30 天使用 30 天（實際天數）

---

## 📊 計算公式

### 本週 / 下週

```
總工時 = 職務總人數 × 8小時/天 × 7天
```

**範例**：

- 醫師 4 人：4 × 8 × 7 = **224 小時**
- 諮詢師 1 人：1 × 8 × 7 = **56 小時**
- 護理師 2 人：2 × 8 × 7 = **112 小時**
- 美療師 2 人：2 × 8 × 7 = **112 小時**

### 未來 30 天

```
總工時 = 職務總人數 × 8小時/天 × 30天
```

**範例**：

- 醫師 4 人：4 × 8 × 30 = **960 小時**
- 諮詢師 1 人：1 × 8 × 30 = **240 小時**
- 護理師 2 人：2 × 8 × 30 = **480 小時**
- 美療師 2 人：2 × 8 × 30 = **480 小時**

---

## 📝 註解說明

### 新增註解

在每個週期的說明文字後方加入：

```
診所營業 7 天，實際需透過輪班覆蓋
```

### 完整說明文字

#### 本週

```
* 本週：今天之前僅計算已完成預約，今天及之後計算所有預約。診所營業 7 天，實際需透過輪班覆蓋
```

#### 下週

```
* 下週：計算所有預排預約（預估）。診所營業 7 天，實際需透過輪班覆蓋
```

#### 未來 30 天

```
* 未來30天：計算所有預排預約（預估）。診所營業 7 天，實際需透過輪班覆蓋
```

---

## 🔧 修改內容

### 檔案：`src/logic/staff/staffWorkloadCards.ts`

#### 1. 函數名稱變更 (Line 156-164)

**修改前**：

```typescript
function getWorkingDays(period: "week" | "next_week" | "future30"): number {
  if (period === "future30") return 22; // 約22個工作天
  return 5; // 一週5個工作天
}
```

**修改後**：

```typescript
/**
 * 計算總天數
 * 本週/下週：7天（診所營業7天）
 * 未來30天：30天
 */
function getTotalDays(period: "week" | "next_week" | "future30"): number {
  if (period === "future30") return 30;
  return 7; // 一週7天（診所營業7天，實際需透過輪班覆蓋）
}
```

#### 2. 總工時計算邏輯 (Line 229-236)

**修改前**：

```typescript
// 醫師：每日6小時；其他：每日8小時
const dailyHours = role === "doctor" ? 6 : 8;
const totalHours = count * dailyHours * workingDays;
```

**修改後**：

```typescript
// 總工時 = 職務總人數 × 8小時/天 × 總天數
// 本週/下週：人數 × 8 × 7天
// 未來30天：人數 × 8 × 30天
const totalHours = count * 8 * totalDays;
```

#### 3. 註解文字更新 (Line 324-329)

**修改前**：

```typescript
if (period === "week")
  note = "* 本週：今天之前僅計算已完成預約，今天及之後計算所有預約";
if (period === "next_week") note = "* 下週：計算所有預排預約（預估）";
if (period === "future30") note = "* 未來30天：計算所有預排預約（預估）";
```

**修改後**：

```typescript
if (period === "week")
  note =
    "* 本週：今天之前僅計算已完成預約，今天及之後計算所有預約。診所營業 7 天，實際需透過輪班覆蓋";
if (period === "next_week")
  note = "* 下週：計算所有預排預約（預估）。診所營業 7 天，實際需透過輪班覆蓋";
if (period === "future30")
  note =
    "* 未來30天：計算所有預排預約（預估）。診所營業 7 天，實際需透過輪班覆蓋";
```

---

## 📊 數值變化對比

### 本週（7 天）

| 職務   | 人數 | 舊版總工時   | 新版總工時   | 變化 |
| ------ | ---- | ------------ | ------------ | ---- |
| 醫師   | 4    | 120h (4×6×5) | 224h (4×8×7) | +87% |
| 諮詢師 | 1    | 40h (1×8×5)  | 56h (1×8×7)  | +40% |
| 護理師 | 2    | 80h (2×8×5)  | 112h (2×8×7) | +40% |
| 美療師 | 2    | 80h (2×8×5)  | 112h (2×8×7) | +40% |

### 未來 30 天

| 職務   | 人數 | 舊版總工時    | 新版總工時    | 變化 |
| ------ | ---- | ------------- | ------------- | ---- |
| 醫師   | 4    | 528h (4×6×22) | 960h (4×8×30) | +82% |
| 諮詢師 | 1    | 176h (1×8×22) | 240h (1×8×30) | +36% |
| 護理師 | 2    | 352h (2×8×22) | 480h (2×8×30) | +36% |
| 美療師 | 2    | 352h (2×8×22) | 480h (2×8×30) | +36% |

---

## 🎯 影響分析

### 負載率變化

由於總工時增加，相同的實際工時下，**負載率會降低**。

**範例**：

```
假設醫師實際工時 = 45.3小時

舊版：45.3 / 120 = 37.8%
新版：45.3 / 224 = 20.2%

差異：-17.6 百分點
```

### 狀態指示變化

負載率降低可能導致狀態等級下降：

| 舊版負載率 | 舊版狀態 | 新版負載率 | 新版狀態 | 變化 |
| ---------- | -------- | ---------- | -------- | ---- |
| 75%        | 偏高 🟠  | 54%        | 適中 🟣  | ↓    |
| 50%        | 適中 🟣  | 36%        | 輕鬆 🟢  | ↓    |

---

## ✅ 驗證

### 編譯測試

```bash
npm run build
# ✓ 編譯成功，無錯誤
```

### 功能測試

1. ✅ 本週總工時正確（人數 × 8 × 7）
2. ✅ 下週總工時正確（人數 × 8 × 7）
3. ✅ 未來 30 天總工時正確（人數 × 8 × 30）
4. ✅ 註解文字正確顯示
5. ✅ 頁面排版未改變

---

## 📝 營運意義

### 為什麼使用 7 天？

1. **診所營業時間**：診所每週營業 7 天
2. **輪班制度**：員工透過輪班方式覆蓋 7 天營業時間
3. **總工時計算**：反映診所整體需要覆蓋的總時數

### 註解說明的重要性

```
診所營業 7 天，實際需透過輪班覆蓋
```

這個註解提醒營運者：

- 總工時是基於診所營業時間計算
- 個別員工不需要工作 7 天
- 需要透過排班制度來分配工作

---

## 🔄 未來可能的調整

如果需要更精確的計算，可以考慮：

1. **實際排班天數**

   - 從排班系統讀取每個員工的實際工作天數
   - 計算更精確的個人負載率

2. **不同職務的工作模式**

   - 全職 vs 兼職
   - 固定班 vs 輪班

3. **假日係數**
   - 考慮國定假日
   - 調整總工時計算

---

**更新日期**: 2025-12-16  
**版本**: v3.1  
**狀態**: ✅ 已完成並測試
