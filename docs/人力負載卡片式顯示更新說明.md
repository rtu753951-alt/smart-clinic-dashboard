# 人力負載壓力分析 - 卡片式顯示更新說明

## 📋 變更摘要

根據您的反饋，已將人力負載壓力分析從**圖表形式**改為**卡片式顯示**，讓營運者能夠一眼看懂負載情況。

### ✅ 主要改進

1. **更易讀的視覺設計**

   - 使用卡片 + 進度條，直觀顯示負載狀態
   - 大字體顯示負載率百分比
   - 顏色編碼狀態指示器（輕鬆/適中/偏高/過載）

2. **完整的週期選擇**

   - ✅ 本週
   - ✅ 下週
   - ✅ 未來 30 天

3. **關鍵資訊一目了然**
   - 實際工時
   - 任務數量
   - 負載率（大字體 + 進度條）
   - 總工時
   - 狀態標籤

---

## 🎨 新設計特點

### 卡片佈局

每個職務一張卡片，包含：

```
┌─────────────────────────────┐
│ 👨‍⚕️ 醫師                    │
│    Workload Analysis        │
├─────────────────────────────┤
│  45.3h      │      12       │
│ 實際工時    │    任務數     │
├─────────────────────────────┤
│ 負載率              25%     │
│ ████████░░░░░░░░░░          │
├─────────────────────────────┤
│ [適中]          224h 總工時 │
└─────────────────────────────┘
```

### 狀態指示器

| 負載率 | 狀態 | 顏色 | 說明       |
| ------ | ---- | ---- | ---------- |
| < 40%  | 輕鬆 | 綠色 | 工作量偏低 |
| 40-69% | 適中 | 紫色 | 工作量正常 |
| 70-89% | 偏高 | 橙色 | 接近高負載 |
| ≥ 90%  | 過載 | 紅色 | 需要調整   |

### 職務專屬顏色

- **醫師**: 藍色 (#3b82f6)
- **諮詢師**: 紫色 (#8b5cf6)
- **護理師**: 綠色 (#10b981)
- **美療師**: 粉色 (#ec4899)

---

## 📁 新增/修改檔案

### 新增檔案

1. **`src/styles/workload-cards.css`**

   - 卡片式顯示的 CSS 樣式
   - 包含進度條動畫、狀態指示器、響應式設計

2. **`src/logic/staff/staffWorkloadCards.ts`**
   - 卡片式顯示的邏輯模組
   - 包含資料計算、卡片渲染、週期切換

### 修改檔案

1. **`index.html`** (Line 470-479)

   - 將 `<canvas>` 改為 `<div id="staffWorkloadCards">`
   - 更新按鈕屬性為 `data-workload-period`
   - 新增 CSS 引用

2. **`src/pages/staffPage.ts`** (Line 6, 19-20)
   - 將 `initStaffWorkloadChart` 改為 `initWorkloadCards`

---

## 💡 功能說明

### 週期選擇

#### 本週

- 顯示本週一到週日的負載
- 今天之前：只計算 `completed` 預約
- 今天及之後：計算所有預約

#### 下週

- 顯示下週一到週日的負載
- 計算所有預排預約（預估）

#### 未來 30 天

- 顯示從今天起 30 天的負載
- 計算所有預排預約（預估）
- 工作天數：約 22 天

### 資料計算

使用與之前相同的**醫師介入比例模型**：

| 療程類型     | 醫師 | 諮詢師 | 美療師 | 護理師 |
| ------------ | ---- | ------ | ------ | ------ |
| Inject/RF    | 35%  | -      | -      | -      |
| Laser        | 15%  | -      | 100%   | -      |
| Drip         | 10%  | -      | -      | 100%   |
| Consultation | 30%  | 70%    | -      | -      |

### 工時計算

```typescript
// 醫師：每日6小時
// 其他職務：每日8小時
const dailyHours = role === "doctor" ? 6 : 8;

// 本週/下週：5個工作天
// 未來30天：22個工作天
const totalHours = count * dailyHours * workingDays;

// 負載率
const percentage = (usedHours / totalHours) * 100;
```

---

## 🎯 使用方式

### 1. 開啟人力分析頁面

點擊側邊欄「人力分析」

### 2. 查看卡片

- 自動顯示本週的負載情況
- 卡片按負載率排序（高到低）

### 3. 切換週期

- 點擊「本週」/「下週」/「未來 30 天」按鈕
- 卡片會立即更新

### 4. 解讀資訊

- **大數字**：負載率百分比
- **進度條**：視覺化負載程度
- **狀態標籤**：快速判斷是否需要調整
- **實際工時 vs 總工時**：了解工作量細節

---

## 📊 範例展示

### 情境：本週負載

```
醫師 (4人)
- 實際工時: 45.3h
- 任務數: 28
- 負載率: 38%
- 狀態: 適中
- 總工時: 120h (4人 × 6h × 5天)

諮詢師 (1人)
- 實際工時: 12.5h
- 任務數: 15
- 負載率: 31%
- 狀態: 輕鬆
- 總工時: 40h (1人 × 8h × 5天)

護理師 (2人)
- 實際工時: 52.8h
- 任務數: 35
- 負載率: 66%
- 狀態: 適中
- 總工時: 80h (2人 × 8h × 5天)

美療師 (2人)
- 實際工時: 68.2h
- 任務數: 42
- 負載率: 85%
- 狀態: 偏高
- 總工時: 80h (2人 × 8h × 5天)
```

### 營運決策

根據上述資料，營運者可以快速判斷：

- ✅ 醫師和諮詢師負載正常
- ✅ 護理師負載適中
- ⚠️ 美療師負載偏高（85%），建議：
  - 調整下週排班
  - 增加美療師人力
  - 分流部分療程

---

## ✅ 優勢對比

### 舊版（圖表）

- ❌ 需要仔細看圖表才能理解
- ❌ 數字較小，不夠醒目
- ❌ 沒有明確的狀態指示
- ❌ 難以快速判斷是否需要調整

### 新版（卡片）

- ✅ 一眼看懂負載情況
- ✅ 大字體顯示關鍵數據
- ✅ 顏色編碼狀態（輕鬆/適中/偏高/過載）
- ✅ 進度條直觀顯示負載程度
- ✅ 按負載率排序，優先顯示需要關注的職務

---

## 🔧 技術細節

### CSS 動畫

- **進度條填充動畫**: 0.8 秒緩動
- **閃爍效果**: 2 秒循環
- **卡片懸停**: 上浮 + 陰影增強

### 響應式設計

```css
/* 桌面版：自動填充，最小280px */
grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));

/* 手機版：單欄顯示 */
@media (max-width: 768px) {
  grid-template-columns: 1fr;
}
```

### 資料排序

卡片按負載率由高到低排序，讓營運者優先看到需要關注的職務。

---

## 🚀 編譯驗證

```bash
npm run build
# ✓ 編譯成功，無錯誤
```

---

## 📝 未來可能的改進

1. **趨勢指示器**

   - 顯示與上週相比的變化（↑ +5% / ↓ -3%）

2. **預警通知**

   - 負載率超過 80%時顯示警告圖標

3. **詳細資訊彈窗**

   - 點擊卡片顯示該職務的詳細工時分布

4. **匯出功能**
   - 將負載資料匯出為 PDF 或 Excel

---

**更新日期**: 2025-12-16  
**版本**: v3.0 (卡片式顯示)  
**狀態**: ✅ 已完成並測試
