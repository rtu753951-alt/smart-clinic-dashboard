# 經營成效摘要卡片彈窗功能說明

## 📋 功能概述

為「經營成效摘要」區塊的三張卡片加上彈窗功能，點擊卡片後顯示詳細分析內容。

---

## 🎯 新增的彈窗功能

### **1. 💰 今日營收狀態詳細分析**

#### **卡片顯示**

- 今日營收狀態（高於/符合/低於預期）
- vs 昨日（百分比）
- vs 近 7 日平均（百分比）

#### **彈窗詳細內容**

- **狀態總覽**：營收狀態評估與說明
- **詳細數據對比**：
  - vs 昨日（百分比 + 成長/下降指示）
  - vs 近 7 日平均（百分比 + 高於/低於平均指示）
- **營運建議**：根據狀態提供 3 條具體建議
  - 高於預期：分析成功因素、複製成功模式、維持高品質服務
  - 符合預期：持續觀察、小幅優化、關注客戶回饋
  - 低於預期：檢視預約狀況、分析表現不佳原因、加強行銷

---

### **2. 📊 本月營收詳細分析**

#### **卡片顯示**

- 本月累計營收總額（格式化數字）
- 完成預約數

#### **彈窗詳細內容**

- **營收總覽**：本月累計營收（大字顯示）
- **關鍵指標**（3 個指標卡）：
  - 完成預約數
  - 平均客單價（總營收 / 完成預約數）
  - 每日平均營收（總營收 / 當前日期）
- **營運洞察**：4 條數據分析與建議
  - 平均客單價分析
  - 每日平均營收參考
  - 高價值療程關注建議
  - 結合營運分佈分析建議

---

### **3. 🔄 本月顧客回診率詳細分析**

#### **卡片顯示**

- 本月回診率（百分比）
- 進度條視覺化
- 顧客黏著度狀態（穩定/普通/偏低）
- 回診客數 / 總客數

#### **彈窗詳細內容**

- **回診率總覽**：回診率大字顯示 + 黏著度狀態
- **客戶結構分析**（3 個指標卡）：
  - 回診客戶數（≥2 次預約）
  - 單次客戶數（僅 1 次預約）
  - 平均回診次數（僅針對回診客）
- **黏著度評估**：根據狀態提供評估說明
  - 穩定（≥45%）：黏著度良好，客戶滿意度高
  - 普通（30-44%）：黏著度中等，尚有提升空間
  - 偏低（<30%）：黏著度偏低，需要關注
- **營運建議**：根據狀態提供 4-5 條具體建議
  - 穩定：維持服務品質、推出會員優惠、收集回饋、分析偏好
  - 普通：加強客戶關懷、設計回診優惠、檢視流失原因、建立分級制度
  - 偏低：檢視滿意度、分析流失原因、加強效果說明、建立回訪機制、推出首次回診優惠

---

## 🔧 技術實作細節

### **修改的檔案**

#### **1. index.html**

- 為三張 metric-card 加上 `js-open-modal` class 和 `data-modal` 屬性
- 加上 `<div class="card-hint">查看詳細資料 →</div>` 提示文字
- 新增三個隱藏的詳細內容區域：
  - `<div id="revenue-today-detail" style="display: none">`
  - `<div id="revenue-monthly-detail" style="display: none">`
  - `<div id="return-visit-detail" style="display: none">`

#### **2. src/pages/overviewPage.ts**

- **updateRevenueStatus()**：在函數末尾加上詳細內容生成
- **updateMonthlyRevenue()**：在函數末尾加上詳細內容生成
- **updateReturnVisitRate()**：在函數末尾加上詳細內容生成
- **bindOverviewCards()**：在 switch 語句中加上三個新的 case
  - `case "revenue-today"`
  - `case "revenue-monthly"`
  - `case "return-visit"`

#### **3. style_overview_sections.css**

- 為 `.metric-card.js-open-modal` 加上 `cursor: pointer`
- 為 `.card-hint` 加上樣式（opacity、transition）
- 為 `.metric-card.js-open-modal:hover .card-hint` 加上 hover 效果

---

## 📊 詳細內容結構

### **共同元素**

所有彈窗詳細內容都包含：

1. **標題**：帶底線的大標題
2. **總覽區**：帶漸層背景的重點數據展示
3. **詳細數據區**：Grid 布局的指標卡片
4. **建議區**：帶左側邊框的營運建議列表
5. **備註區**：灰色背景的說明文字

### **樣式特色**

- 使用 CSS 變數（`var(--text-heading)`, `var(--accent-color)` 等）
- 響應式 Grid 布局（`repeat(auto-fit, minmax(200px, 1fr))`）
- 漸層背景（`linear-gradient(135deg, ...)`）
- 動態顏色（根據狀態改變）
- 圓角卡片（`border-radius: 8px`）

---

## 🎨 視覺設計

### **卡片提示**

- 預設：灰色、半透明（opacity: 0.6）
- Hover：藍色、完全顯示（opacity: 1）
- 文字：「查看詳細資料 →」

### **彈窗標題**

- 💰 今日營收狀態詳細分析
- 📊 本月營收詳細分析
- 🔄 本月顧客回診率詳細分析

### **色彩語意**

- **今日營收狀態**：
  - 高於預期：綠色 (#10b981)
  - 符合預期：青色 (#06b6d4)
  - 低於預期：琥珀色 (#f59e0b)
- **本月營收**：藍色 (#3b82f6)
- **回診率**：
  - 穩定：綠色 (#10b981)
  - 普通：琥珀色 (#f59e0b)
  - 偏低：紅色 (#ef4444)

---

## ✅ 功能特色

### **1. 智能建議**

根據實際數據狀態提供不同的營運建議，不是固定文字。

### **2. 數據可視化**

- 大字顯示重點數據
- 進度條、百分比、箭頭指示
- 色彩編碼（綠色=好、黃色=中、紅色=差）

### **3. 完整分析**

- 不只顯示數字，還提供解讀與建議
- 包含計算邏輯說明（如回診客定義）
- 提供可操作的具體建議

### **4. 一致性**

- 與其他彈窗使用相同的 ModalManager
- 樣式與整體儀表板一致
- 響應式布局支援

---

## 🧪 測試檢查清單

### **功能測試**

- [ ] 點擊「今日營收狀態」卡片，彈窗正常開啟
- [ ] 點擊「本月營收」卡片，彈窗正常開啟
- [ ] 點擊「本月回診率」卡片，彈窗正常開啟
- [ ] 彈窗內容正確顯示（無「載入中...」或空白）
- [ ] 彈窗關閉功能正常
- [ ] 切換月份後，彈窗內容會更新

### **樣式測試**

- [ ] 卡片 hover 時顯示「查看詳細資料 →」提示
- [ ] 卡片 hover 時有視覺回饋（陰影、位移）
- [ ] 彈窗內容排版正確（無錯位或溢出）
- [ ] 響應式布局正常（桌面、平板、手機）
- [ ] 色彩根據狀態正確顯示

### **數據測試**

- [ ] 今日營收狀態計算正確
- [ ] 本月營收總額計算正確
- [ ] 平均客單價計算正確
- [ ] 每日平均營收計算正確
- [ ] 回診率計算正確
- [ ] 單次客戶數計算正確
- [ ] 平均回診次數計算正確

### **邏輯測試**

- [ ] 營運建議根據狀態正確顯示
- [ ] 黏著度評估根據回診率正確判斷
- [ ] 狀態色彩根據數據正確改變
- [ ] Console 沒有錯誤訊息

---

## 📝 程式碼範例

### **HTML 綁定**

```html
<article class="metric-card js-open-modal" data-modal="revenue-today">
  <div class="metric-header">...</div>
  <div class="metric-body" id="revenue-status-content">...</div>
  <div class="card-hint">查看詳細資料 →</div>
</article>
```

### **TypeScript 彈窗綁定**

```typescript
case "revenue-today": {
    const detailContent = document.getElementById("revenue-today-detail")?.innerHTML || "";
    const content = detailContent || "無營收資料";
    ModalManager.open("💰 今日營收狀態詳細分析", content);
    break;
}
```

### **詳細內容生成**

```typescript
const detailContainer = document.getElementById("revenue-today-detail");
if (detailContainer) {
  const detailHTML = `
        <div style="padding: 20px;">
            <h3>💰 今日營收狀態詳細分析</h3>
            <!-- 狀態總覽 -->
            <!-- 詳細數據 -->
            <!-- 營運建議 -->
        </div>
    `;
  detailContainer.innerHTML = detailHTML;
}
```

---

## 🚀 部署說明

### **已完成的步驟**

1. ✅ HTML 結構修改（加上彈窗綁定）
2. ✅ TypeScript 函數修改（生成詳細內容）
3. ✅ CSS 樣式新增（卡片提示樣式）
4. ✅ TypeScript 編譯成功

### **測試步驟**

1. 重新整理瀏覽器：`http://localhost:8000`
2. 點擊「今日營收狀態」卡片，檢查彈窗
3. 點擊「本月營收」卡片，檢查彈窗
4. 點擊「本月回診率」卡片，檢查彈窗
5. 檢查 Console 是否有錯誤
6. 測試月份切換功能

---

## 🎉 完成！

現在經營成效摘要的三張卡片都支援彈窗功能，提供詳細的數據分析與營運建議！

**特色**：

- 📊 詳細的數據分析
- 💡 智能的營運建議
- 🎨 美觀的視覺設計
- 📱 響應式布局支援
- 🔄 與既有彈窗系統整合
